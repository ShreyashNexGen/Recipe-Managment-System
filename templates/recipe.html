{% extends "base.html" %}

{% block title %}Recipe Management{% endblock %}

{% block content %}
<div class="content-header">
    <h1>Recipe Overview</h1>
    <button onclick="toggleRecipeForm()" class="add-button">+ Add Recipe</button>
</div>

<div id="add-recipe-section">
    <div id="recipe-form">
        <div id="loadRecipeSection" class="popup-recipe-header">
            <h3>Add New Recipe</h3>
            <button type="button" class="close-button" onclick="toggleRecipeForm()">X</button>
            <div >
                <label for="load_recipe_id">Load Existing Recipe:</label>
                <div class="recipe-container">
                    <!-- Recipe ID -->
                    <div class="dropdown-container">
                        <input type="text" id="load_recipe_id" placeholder="Select Recipe ID" readonly>
                        <span class="dropdown-icon"><i class="fa-solid fa-caret-down"></i></span>
                        <div class="dropdown-list" id="dropdown_recipe_id"></div>
                    </div>
                
                    <!-- Recipe Name -->
                    <div class="dropdown-container">
                        <input type="text" id="load_recipe_name" placeholder="Select Recipe Name" readonly>
                        <span class="dropdown-icon"><i class="fa-solid fa-caret-down"></i></span>
                        <div class="dropdown-list" id="dropdown_recipe_name"></div>
                    </div>
                </div>
                <button type="button" onclick="loadRecipe()">Load Recipe</button>
            </div>
        </div>
        <form action="/add_recipe" method="POST" class="recipe-form">

            <!-- Step 1: Basic Recipe Details -->
            <div class="form-step" id="step1">
                <div class="form-row">
                    <label for="recipe_id">Recipe ID:</label>
                    <input type="text" id="recipe_id" name="recipe_id" required>
        
                    <label for="recipe_name">Recipe Name:</label>
                    <input type="text" id="recipe_name" name="recipe_name" required>
        
                    <label for="filter_size">Filter Size:</label>
                    <input type="text" id="filter_size" name="filter_size" required>
        
                    <label for="filter_code">Filter Code:</label>
                    <input type="text" id="filter_code" name="filter_code" required>
        
                    <label for="art_no">Art No:</label>
                    <input type="text" id="art_no" name="art_no" required>
                </div>
                <div class="form-buttons">
                    <button type="button" onclick="loadLastPLCValues()">Upload Settings</button>
                    <button type="button" onclick="nextStep()">Next</button>
                </div>
            </div>
        
            <!-- Step 2: Roll Positions -->
            <div class="form-step" id="step2" style="display:none;">
                <h1 style="text-align: center; padding:10px">Roll Positions</h1>
                <div class="form-row">
                    {% for i in range(1, 10) %}
                    <label for="pos{{ i }}">Pos{{ i }}:</label>
                    <select id="pos{{ i }}" name="pos{{ i }}">
                        <option value="" disabled selected>Select a value</option>
                        {% for value in pos_values %}
                        <option value="{{ value }}">{{ value }}</option>
                        {% endfor %}
                    </select>
                    {% endfor %}
                </div>
                <div class="form-buttons">
                    <button type="button" onclick="loadLastPLCValues()">Upload Settings</button>
                    <button type="button" onclick="prevStep()">Back</button>
                    <button type="button" onclick="nextStep()">Next</button>
                </div>
            </div>
        
            <!-- Step 3: Machine Settings -->
            <div class="form-step" id="step3" style="display:none;">
                <h1 style="text-align: center;">Machine Settings</h1>
                <div class="form-row">
                    <!-- Machine setting fields here -->
                    <label for="Alu_coil_width">Alu Coil Width:</label>
                    <input type="text" id="Alu_coil_width" name="Alu_coil_width">
        
                    <label for="Alu_roller_type">Alu Roller Type:</label>
                    <input type="text" id="Alu_roller_type" name="Alu_roller_type">
        
                    <label for="Spacer">Spacer:</label>
                    <input type="text" id="Spacer" name="Spacer">
        
                    <label for="Motor_speed">Motor Speed:</label>
                    <input type="text" id="Motor_speed" name="Motor_speed">
        
                    <label for="Motor_stroke">Motor Stroke:</label>
                    <input type="text" id="Motor_stroke" name="Motor_stroke">
                </div>
                <div class="form-row">
                    <label for="Motor_force">Motor Force:</label>
                    <input type="text" id="Motor_force" name="Motor_force">
        
                    <label for="Corr1Feed_length">Corr1 Feed Length:</label>
                    <input type="text" id="Corr1Feed_length" name="Corr1Feed_length">
        
                    <label for="Corr2feed_length">Corr2 Feed Length:</label>
                    <input type="text" id="Corr2feed_length" name="Corr2feed_length">
        
                    <label for="Pleat_Height">Pleat Height:</label>
                    <input type="text" id="Pleat_Height" name="Pleat_Height">
        
                    <label for="Blade_opening">Blade Opening:</label>
                    <input type="text" id="Blade_opening" name="Blade_opening">
                </div>
                <div class="form-row">
                    <label for="Left_Blade_MediaTHickness">Left Blade Media Thickness:</label>
                    <input type="text" id="Left_Blade_MediaTHickness" name="Left_Blade_MediaTHickness">
            
                    <label for="Right_Blade_MediaThickness">Right Blade Media Thickness:</label>
                    <input type="text" id="Right_Blade_MediaThickness" name="Right_Blade_MediaThickness">
            
                    <label for="Soft_Touch">Soft Touch:</label>
                    <input type="text" id="Soft_Touch" name="Soft_Touch">
            
                    <label for="Press_Touch">Press Touch:</label>
                    <input type="text" id="Press_Touch" name="Press_Touch">
            
                    <label for="Puller_Start_pos">Puller Start Position:</label>
                    <input type="text" id="Puller_Start_pos" name="Puller_Start_pos">
                </div>
            
                <div class="form-row">
                    <label for="Puller_End_pos">Puller End Position:</label>
                    <input type="text" id="Puller_End_pos" name="Puller_End_pos">
            
                    <label for="Puller2_Feed_Correction">Puller 2 Feed Correction:</label>
                    <input type="text" id="Puller2_Feed_Correction" name="Puller2_Feed_Correction">
            
                    <label for="Filter_Box_Height">Filter Box Height:</label>
                    <input type="text" id="Filter_Box_Height" name="Filter_Box_Height">
            
                    <label for="Filter_Box_Width">Filter Box Width:</label>
                    <input type="text" id="Filter_Box_Width" name="Filter_Box_Width">
            
                    <label for="Filter_Box_Length">Filter Box Length:</label>
                    <input type="text" id="Filter_Box_Length" name="Filter_Box_Length">
                </div>
            
                <div class="form-row">
                    <label for="Set_Pleat_Count">Set Pleat Count:</label>
                    <input type="text" id="Set_Pleat_Count" name="Set_Pleat_Count">
            
                    <label for="Set_Pleat_Pitch">Set Pleat Pitch:</label>
                    <input type="text" id="Set_Pleat_Pitch" name="Set_Pleat_Pitch">
            
                    <label for="Set_Batch_Count">Set Batch Count:</label>
                    <input type="text" id="Set_Batch_Count" name="Set_Batch_Count">
            
                    <label for="Machine_Speed_Ref">Machine Speed Reference:</label>
                    <input type="text" id="Machine_Speed_Ref" name="Machine_Speed_Ref">
            
                    <label for="Decoiler_Set_point">Decoiler Set Point:</label>
                    <input type="text" id="Decoiler_Set_point" name="Decoiler_Set_point">
                </div>
            
                <div class="form-row">
                    <label for="Low_Dia_Set">Low Diameter Set:</label>
                    <input type="text" id="Low_Dia_Set" name="Low_Dia_Set">
            
                    <label for="Cutter_Park_pos">Cutter Park Position:</label>
                    <input type="text" id="Cutter_Park_pos" name="Cutter_Park_pos">
            
                    <label for="Cutter_Fwd_Pos">Cutter Forward Position:</label>
                    <input type="text" id="Cutter_Fwd_Pos" name="Cutter_Fwd_Pos">
                </div>
            
                <!-- Continue adding remaining machine fields here, as you had -->
                <div class="form-buttons">
                    <button type="button" onclick="loadLastPLCValues()">Upload Settings</button>
                    <button type="button" onclick="prevStep()">Back</button>
                    <button type="button" onclick="nextStep()">Next</button>
                </div>
            </div>
        
            <!-- Step 4: Air Inspection Settings -->
            <div class="form-step" id="step4" style="display:none;">
                <h1 style="text-align: center; padding:10px">Air Inspection Settings</h1>
                <div class="form-row">
                    <label for="databaseAvailable">Database Available:</label>
                    <input type="text" id="databaseAvailable" name="databaseAvailable">
        
                    <label for="Width">Width:</label>
                    <input type="text" id="Width" name="Width">
        
                    <label for="Height">Height:</label>
                    <input type="text" id="Height" name="Height">
        
                    <label for="Depth">Depth:</label>
                    <input type="text" id="Depth" name="Depth">
        
                    <label for="Art_Num">Art Number:</label>
                    <input type="text" id="Art_Num" name="Art_Num">
                </div>
                <div class="form-row">
                    <label for="Air_Flow_Set">Air Flow Set:</label>
                    <input type="text" id="Air_Flow_Set" name="Air_Flow_Set">
        
                    <label for="Pressure_Drop_Setpoint">Pressure Drop Setpoint:</label>
                    <input type="text" id="Pressure_Drop_Setpoint" name="Pressure_Drop_Setpoint">
        
                    <label for="Lower_Tolerance1">Lower Tolerance1:</label>
                    <input type="text" id="Lower_Tolerance1" name="Lower_Tolerance1">
        
                    <label for="Lower_Tolerance2">Lower Tolerance2:</label>
                    <input type="text" id="Lower_Tolerance2" name="Lower_Tolerance2">
        
                    <label for="Upper_Tolerance1">Upper Tolerance1:</label>
                    <input type="text" id="Upper_Tolerance1" name="Upper_Tolerance1">
        
                    <label for="Upper_Tolerance2">Upper Tolerance2:</label>
                    <input type="text" id="Upper_Tolerance2" name="Upper_Tolerance2">
                </div>
                <div class="form-buttons">
                    <button type="button" onclick="loadLastPLCValues()">Upload Settings</button>
                    <button type="button" onclick="prevStep()">Back</button>
                    <button type="submit">Submit Recipe</button>
                </div>
            </div>
        
        </form>
        <!-- <style>
            /* Button Styling */
            
            </style> -->
            
            <script>
                let currentStep = 1;
            
                function showStep(stepIndex) {
                    const steps = document.querySelectorAll(".form-step");
            
                    // Hide all steps
                    steps.forEach(function(stepDiv) {
                        stepDiv.style.display = 'none';
                    });
            
                    // Show the selected step
                    document.getElementById('step' + stepIndex).style.display = 'block';
            
                    // Show Load Recipe section only on Step 1
                    const loadRecipeDiv = document.getElementById("loadRecipeSection");
                    if (stepIndex === 1) {
                        loadRecipeDiv.style.display = "block";
                    } else {
                        loadRecipeDiv.style.display = "none";
                    }
                }
            
                function nextStep() {
                    if (currentStep < 4) {
                        currentStep++;
                        showStep(currentStep);
                    }
                }
            
                function prevStep() {
                    if (currentStep > 1) {
                        currentStep--;
                        showStep(currentStep);
                    }
                }
            
                // Initially show the first step
                showStep(currentStep);
            
                // Placeholder for upload settings
                function loadLastPLCValues() {
                    alert('Loading last PLC settings...');
                }
            </script>
            
        
    </div>
</div>
<div id="update-recipe-section" style="display: none;">
    <div id="update-recipe-form">
        <div class="popup-recipe-header">
            <h3>Update Recipe</h3>
            <button type="button" class="close-button" onclick="toggleUpdatePopup()">X</button>
        </div>
        <form action="/update_recipe" method="POST" class="recipe-form">
            <div class="form-step1" id="updatestep1">
                <div class="form-row">
                    <label for="update_recipe_id">Recipe ID:</label>
                    <input type="text" id="update_recipe_id" name="recipe_id" readonly>
        
                    <label for="update_recipe_name">Recipe Name:</label>
                    <input type="text" id="update_recipe_name" name="recipe_name" required>
        
                    <label for="update_filter_size">Filter Size:</label>
                    <input type="text" id="update_filter_size" name="filter_size" required>
        
                    <label for="update_filter_code">Filter Code:</label>
                    <input type="text" id="update_filter_code" name="filter_code" required>
        
                    <label for="update_art_no">Art No:</label>
                    <input type="text" id="update_art_no" name="art_no" required>
                </div>
                <div class="form-buttons">
                    <button type="button" onclick="nextStep()">Next</button>
                </div>
            </div>
            <div class="form-step1" id="updatestep2" style="display:none;">
                <h1 style="display: block; margin: 0 auto; text-align: center;">Roll Positions</h1>
            <div class="form-row">
            {% for i in range(1, 10) %}
            <label for="update_pos{{ i }}">Pos{{ i }}:</label>
            <select id="update_pos{{ i }}" name="pos{{ i }}">
                <option value="" disabled selected>Select a value</option>
                {% for value in pos_values %}
                <option value="{{ value }}">{{ value }}</option>
                {% endfor %}
            </select>
            {% endfor %}
             </div>
             <div class="form-buttons">
                <button type="button" onclick="prevStep()">Back</button>
                <button type="button" onclick="nextStep()">Next</button>
            </div>
            </div>
            <div class="form-step1" id="updatestep3" style="display:none;">
                <h1 style="display: block; margin: 0 auto; text-align: center;">Machine Settings</h1>
                <div class="form-row">
                    <label for="update_alu_coil_width">Alu Coil Width:</label>
                    <input type="text" id="update_alu_coil_width" name="Alu_coil_width">
        
                    <label for="update_alu_roller_type">Alu Roller Type:</label>
                    <input type="text" id="update_alu_roller_type" name="Alu_roller_type">
        
                    <label for="update_spacer">Spacer:</label>
                    <input type="text" id="update_spacer" name="Spacer">
        
                    <label for="update_motor_speed">Motor Speed:</label>
                    <input type="text" id="update_motor_speed" name="Motor_speed">
        
                    <label for="update_motor_stroke">Motor Stroke:</label>
                    <input type="text" id="update_motor_stroke" name="Motor_stroke">
                    </div>
                    <div class="form-row">
                    <label for="update_motor_force">Motor Force:</label>
                    <input type="text" id="update_motor_force" name="Motor_force">
                    <!-- New fields added -->
                    <label for="update_Corr1Feed_length">Corr1 Feed Length:</label>
                    <input type="text" id="update_Corr1Feed_length" name="Corr1Feed_length">
        
                    <label for="update_Corr2feed_length">Corr2 Feed Length:</label>
                    <input type="text" id="update_Corr2feed_length" name="Corr2feed_length">
        
                    <label for="update_Pleat_Height">Pleat Height:</label>
                    <input type="text" id="update_Pleat_Height" name="Pleat_Height">
        
                    <label for="update_Blade_opening">Blade Opening:</label>
                    <input type="text" id="update_Blade_opening" name="Blade_opening">
                    </div>
                    <div class="form-row">
                    <label for="update_Left_Blade_MediaTHickness">Left Blade Media Thickness:</label>
                    <input type="text" id="update_Left_Blade_MediaTHickness" name="Left_Blade_MediaTHickness">
        
                    <label for="update_Right_Blade_MediaThickness">Right Blade Media Thickness:</label>
                    <input type="text" id="update_Right_Blade_MediaThickness" name="Right_Blade_MediaThickness">
        
                    <label for="update_Soft_Touch">Soft Touch:</label>
                    <input type="text" id="update_Soft_Touch" name="Soft_Touch">
        
                    <label for="update_Press_Touch">Press Touch:</label>
                    <input type="text" id="update_Press_Touch" name="Press_Touch">
        
                    <label for="update_Puller_Start_pos">Puller Start Position:</label>
                    <input type="text" id="update_Puller_Start_pos" name="Puller_Start_pos">
                     </div>
                     <div class="form-row">
                    <label for="update_Puller_End_pos">Puller End Position:</label>
                    <input type="text" id="update_Puller_End_pos" name="Puller_End_pos">
         
                    <label for="update_Puller2_Feed_Correction">Puller 2 Feed Correction:</label>
                    <input type="text" id="update_Puller2_Feed_Correction" name="Puller2_Feed_Correction">
          
                    <label for="update_Filter_Box_Height">Filter Box Height:</label>
                    <input type="text" id="update_Filter_Box_Height" name="Filter_Box_Height">
                    
                    <label for="update_Filter_Box_Width">Filter Box Width:</label>
                    <input type="text" id="update_Filter_Box_Width" name="Filter_Box_Width">
        
                    <label for="update_Filter_Box_Length">Filter Box Length:</label>
                    <input type="text" id="update_Filter_Box_Length" name="Filter_Box_Length">
                     </div>
                     <div class="form-row">
                    <label for="update_Set_Pleat_Count">Set Pleat Count:</label>
                    <input type="text" id="update_Set_Pleat_Count" name="Set_Pleat_Count">
        
                    <label for="update_Set_Pleat_Pitch">Set Pleat Pitch:</label>
                    <input type="text" id="update_Set_Pleat_Pitch" name="Set_Pleat_Pitch">
        
                    <label for="update_Set_Batch_Count">Set Batch Count:</label>
                    <input type="text" id="update_Set_Batch_Count" name="Set_Batch_Count">
                    
                    <label for="update_Machine_Speed_Ref">Machine Speed Reference:</label>
                    <input type="text" id="update_Machine_Speed_Ref" name="Machine_Speed_Ref">
        
                    <label for="update_Decoiler_Set_point">Decoiler Set Point:</label>
                    <input type="text" id="update_Decoiler_Set_point" name="Decoiler_Set_point">
                     </div>
                     <div class="form-row">
                    <label for="update_Low_Dia_Set">Low Diameter Set:</label>
                    <input type="text" id="update_Low_Dia_Set" name="Low_Dia_Set">
        
                    <label for="update_Cutter_Park_pos">Cutter Park Position:</label>
                    <input type="text" id="update_Cutter_Park_pos" name="Cutter_Park_pos">
        
                    <label for="update_Cutter_Fwd_Pos">Cutter Forward Position:</label>
                    <input type="text" id="update_Cutter_Fwd_Pos" name="Cutter_Fwd_Pos">
                    
                    </div>
                    <div class="form-buttons">
                        <button type="button" onclick="prevStep()">Back</button>
                        <button type="button" onclick="nextStep()">Next</button>
                    </div>
            </div>
            <div class="form-step1" id="updatestep4" style="display:none;">
                <h1 style="display: block; margin: 0 auto; text-align: center;">Air Inspection Settings</h1>
                <div class="form-row">
                    <label for="update_databaseAvailable">Database Available:</label>
                    <input type="text" id="update_databaseAvailable" name="databaseAvailable">
        
                    <label for="update_Width">Width:</label>
                    <input type="text" id="update_Width" name="Width">
        
                    <label for="update_Height">Height:</label>
                    <input type="text" id="update_Height" name="Height">
        
                    <label for="update_Depth">Depth:</label>
                    <input type="text" id="update_Depth" name="Depth">
        
                    <label for="update_Art_Num">Art Number.:</label>
                    <input type="text" id="update_Art_Num" name="Art_Num">
                    </div>
                    <div class="form-row">
                    <label for="update_Air_Flow_Set">Air Flow Set:</label>
                    <input type="text" id="update_Air_Flow_Set" name="Air_Flow_Set">
        
                    <label for="update_Pressure_Drop_Setpoint">Pressure Drop Setpoint:</label>
                    <input type="text" id="update_Pressure_Drop_Setpoint" name="Pressure_Drop_Setpoint">
        
                    <label for="update_Lower_Tolerance1">Lower Tolerance1:</label>
                    <input type="text" id="update_Lower_Tolerance1" name="Lower_Tolerance1">
        
                    <label for="update_Lower_Tolerance2">Lower Tolerance2:</label>
                    <input type="text" id="update_Lower_Tolerance2" name="Lower_Tolerance2">
        
                    <label for="update_Upper_Tolerance1">Upper Tolerance1:</label>
                    <input type="text" id="update_Upper_Tolerance1" name="Upper_Tolerance1">
                    </div>
                    <div class="form-row">
                    <label for="update_Upper_Tolerance2">Upper Tolerance2:</label>
                    <input type="text" id="update_Upper_Tolerance2" name="Upper_Tolerance2">
                    </div>
                    <div class="form-buttons">
                        <button type="button" onclick="prevStep()">Back</button>
                        <button type="submit" class="submit-button1">Update Recipe</button></div>
                    </div>
            </div>
        </form>
        <script>
            let currentStep1 = 1;
            function showStep(step) {
                // Hide all steps
                document.querySelectorAll('.form-step1').forEach(function(stepDiv) {
                    stepDiv.style.display = 'none';
                });
                // Show the selected step
                document.getElementById('step' + step).style.display = 'block';
            }
            
            function nextStep() {
                if (currentStep1 < 4) {
                    currentStep1++;
                    showStep(currentStep1);
                }
            }
            
            function prevStep() {
                if (currentStep1 > 1) {
                    currentStep1--;
                    showStep(currentStep1);
                }
            }
            
            // Initially show the first step
            showStep(currentStep1);
            
        </script>
    </div>
</div>






<style>
    .recipe-form {
        display: flex;
        padding-left: 10px;
    padding-right: 10px;
        flex-direction: column;
        width: 100%;
        max-width: 1200px; /* Adjust based on your layout */
        margin: auto;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: repeat(10, 1fr); /* 4 equal columns */
        gap: 15px; /* Space between items */
        align-items: center;
        /*margin-bottom: 10px; /* Space between rows */
    }
    .form-buttons {
        display: flex;
        justify-content: center; /* Centers buttons */
        gap: 10px; /* Adds spacing between buttons */
        margin-bottom: 10px;
    /* margin-top: 10px; */
    }
    label {
        font-weight: bold;
        display: block;
    }
    
    input, select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    
    /* Responsive Design */
    @media (max-width: 992px) {
        .form-row {
            grid-template-columns: repeat(2, 1fr); /* 2 columns on tablets */
        }
    }
    
    @media (max-width: 600px) {
        .form-row {
            grid-template-columns: repeat(1, 1fr); /* 1 column on mobile */
        }
    }
    
    .submit-button1 {
        display: inline-block; /* Ensures buttons stay in line */
        background-color: #007bff; /* Darker purple */
        color: rgb(27, 26, 26);
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        margin-right: 10px; /* Space between buttons */
    }
    .submit-button1:last-child {
        margin-right: 0; /* Remove margin from the last button */
    }
    /* Styling for table header */
    .highlighted-tag{
        font-weight: bold;
        font-size: 20px;
    }
.highlighted-header {
    background-color: #007bff; /* Corporate blue */
    color: white; /* White text */
    font-size: 16px;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Soft shadow */
}

    /* Center align all table cells */
    #recipetable th, #recipetable td {
        text-align: center; /* Center-align text */
        vertical-align: middle; /* Center-align content vertically */
    }

    /* Optional: Adjust padding for a cleaner look */
    #recipetable th, #recipetable td {
        padding: 8px;
    }
    
    /* Flexbox container for side-by-side layout */
    .recipe-container {
        display: flex;
        justify-content: center;         /* Center the dropdowns horizontally */
        align-items: flex-start;         /* Align tops of each dropdown */
        gap: 15px;                       /* Space between dropdowns */
        margin-top: 10px;
        flex-wrap: wrap;
    }

.dropdown-container {
    position: relative;
    width: 220px; /* Slightly wider for balance */
    margin: 5px 10px;
}

.dropdown-container input[type="text"] {
    width: 100%;
    margin-top: 15px;
    padding: 10px 35px 10px 12px; /* Room for icon on the right */
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
    background-color: #fff;
    transition: border-color 0.3s, box-shadow 0.3s;
    box-sizing: border-box;
}

.dropdown-container input[type="text"]:focus {
    border-color: #8e24aa; /* Match your theme */
    box-shadow: 0 0 5px rgba(142, 36, 170, 0.3);
    outline: none;
}

.dropdown-container .dropdown-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
    font-size: 14px;
    pointer-events: none; /* Let clicks go through */
}
.dropdown-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 6px;
    background-color: #fff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    position: absolute;
    width: 100%;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none; /* toggle this with JS */
}
.dropdown-list div {
    padding: 8px 12px;
    text-align: center;  /* Center the text */
    cursor: pointer;
    border-bottom: 1px solid #eee;
    font-size: 14px;
}

.dropdown-list div:hover {
    background-color: #f2f2f2;
}

/*.dropdown-container {
    min-width: 150px;
    padding: 3px; 
    position: relative;
    display: flex;
    align-items: center;
    padding: 5px;
    margin-bottom: 10px;
    min-width: 150px;
}


.dropdown-container input {
    font-size: small;
    padding: 5px; 
    outline: none;
    background-color: #ffffff;
    flex: 1;
    padding: 8px;
    cursor: pointer;
}


.dropdown-icon {
    cursor: pointer;
    padding: 5px;
    margin-bottom: 20px;
}

.dropdown-list {
    font-size: 12px; 
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ccc;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    max-height: 200px;
    overflow-y: auto;
    display: none;
    border-radius: 5px;
}


.dropdown-item {
    padding: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s ease-in-out;
}

/* Hover effect */
.dropdown-item:hover {
    background: #f5f5f5;
}
label[for="load_recipe_id"] {
    display: block;
    text-align: center;
    font-weight: 500;
    margin-bottom: 5px;
}
    
    
</style>
<div class="table-container">
    <table id="recipetable">
        <thead>
            <tr>
                <th>Serial No.</th>
                <th >Recipe ID</th>
                <th>Recipe Name</th>
                <th>Filter Size</th>
                <th>Filter Code</th>
                <th>Art No</th>
                <th>Action</th>
                <th>Update</th>
            </tr>
        </thead>
        <tbody>
            {% for recipe in recipes %}
            <tr id="row-{{ recipe.Recipe_ID }}">
                <td>{{ (page-1)*per_page + loop.index }}</td>
                <td class="highlighted-header" style="font-style: white;"><a href="{{ url_for('recipe_details', recipe_id=recipe.Recipe_ID) }}">{{ recipe.Recipe_ID }}</a></td>
                <td>{{recipe.Recipe_Name}}</td>
                <td>{{ recipe.Filter_Size }}</td>
                <td>{{ recipe.Filter_Code }}</td>
                <td>{{ recipe.Art_No }}</td>
                <td>
                    <!-- Delete Button -->
                    <button class="delete-button" onclick="confirmDeleteRecipe('{{ recipe.Recipe_ID }}')">
                        <i class="fa fa-trash"></i> 
                    </button>
                </td>
                <td>
                    <!-- Update Button -->
                    <button class="update-button" onclick="openUpdatePopup('{{ recipe.Recipe_ID }}')">
                        <i class="fa-regular fa-pen-to-square"></i> 
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="pagination-container">
    {% if page > 1 %}
      <a href="{{ url_for('recipe_list', page=page - 1) }}" class="pagination-btn">Previous</a>
    {% else %}
      <span class="pagination-btn disabled">Previous</span>
    {% endif %}
    
    {% for p in range(1, total_pages + 1) %}
      <a href="{{ url_for('recipe_list', page=p) }}" class="pagination-btn {% if p == page %}active{% endif %}">{{ p }}</a>
    {% endfor %}
    
    {% if page < total_pages %}
      <a href="{{ url_for('recipe_list', page=page + 1) }}" class="pagination-btn">Next</a>
    {% else %}
      <span class="pagination-btn disabled">Next</span>
    {% endif %}
</div>
<script>
function loadRecipe() {
    const recipeId = document.getElementById("load_recipe_id").value;
    const recipeName = document.getElementById("load_recipe_name").value;

    if (!recipeId && !recipeName) {
        alert("Please enter either a Recipe ID or a Recipe Name to load!");
        return;
    }
    

    console.log("Sending recipe ID:", recipeId,"and Recipe Name",recipeName); // Debug log

    fetch(`/get_recipe?recipe_id=${recipeId}&recipe_name=${encodeURIComponent(recipeName)}`, {
        method: "GET",
    })
        .then((response) => response.json())
        .then((data) => {
            console.log("Response data:", data); // Debug log

            if (data.success) {
                // Populate form fields with the response data
                document.getElementById("recipe_id").value = data.recipe_id;
                document.getElementById("recipe_name").value = data.recipe_name;
                document.getElementById("filter_size").value = data.filter_size;
                document.getElementById("filter_code").value = data.filter_code;
                document.getElementById("art_no").value = data.art_no;
                document.getElementById("Alu_coil_width").value = data.Alu_coil_width;
                document.getElementById("Alu_roller_type").value = data.Alu_roller_type;
                document.getElementById("Spacer").value = data.Spacer;
                document.getElementById("Motor_speed").value = data.Motor_speed;
                document.getElementById("Motor_stroke").value = data.Motor_stroke;
                document.getElementById("Motor_force").value = data.Motor_force;
                document.getElementById("Corr1Feed_length").value = data.Corr1Feed_length;
                document.getElementById("Corr2feed_length").value = data.Corr2feed_length;
                document.getElementById("Pleat_Height").value = data.Pleat_Height;
                document.getElementById("Blade_opening").value = data.Blade_opening;
                document.getElementById("Left_Blade_MediaTHickness").value = data.Left_Blade_MediaTHickness;
                document.getElementById("Right_Blade_MediaThickness").value = data.Right_Blade_MediaThickness;
                document.getElementById("Soft_Touch").value = data.Soft_Touch;
                document.getElementById("Press_Touch").value = data.Press_Touch;
                document.getElementById("Puller_Start_pos").value = data.Puller_Start_pos;
                document.getElementById("Puller_End_pos").value = data.Puller_End_pos;
                document.getElementById("Puller2_Feed_Correction").value = data.Puller2_Feed_Correction;
                document.getElementById("Filter_Box_Height").value = data.Filter_Box_Height;
                document.getElementById("Filter_Box_Width").value = data.Filter_Box_Width;
                document.getElementById("Filter_Box_Length").value = data.Filter_Box_Length;
                document.getElementById("Set_Pleat_Count").value = data.Set_Pleat_Count;
                document.getElementById("Set_Pleat_Pitch").value = data.Set_Pleat_Pitch;
                document.getElementById("Set_Batch_Count").value = data.Set_Batch_Count;
                document.getElementById("Machine_Speed_Ref").value = data.Machine_Speed_Ref;
                document.getElementById("Decoiler_Set_point").value = data.Decoiler_Set_point;
                document.getElementById("Low_Dia_Set").value = data.Low_Dia_Set;
                document.getElementById("Cutter_Park_pos").value = data.Cutter_Park_pos;
                document.getElementById("Cutter_Fwd_Pos").value = data.Cutter_Fwd_Pos;
                document.getElementById("databaseAvailable").value = data.databaseAvailable;
                document.getElementById("Width").value = data.Width;
                document.getElementById("Height").value = data.Height;
                document.getElementById("Depth").value = data.Depth;
                document.getElementById("Art_Num").value = data.Art_Num;
                document.getElementById("Air_Flow_Set").value = data.Air_Flow_Set;
                document.getElementById("Pressure_Drop_Setpoint").value = data.Pressure_Drop_Setpoint;
                document.getElementById("Lower_Tolerance1").value = data.Lower_Tolerance1;
                document.getElementById("Lower_Tolerance2").value = data.Lower_Tolerance2;
                document.getElementById("Upper_Tolerance1").value = data.Upper_Tolerance1;
                document.getElementById("Upper_Tolerance2").value = data.Upper_Tolerance2;

                 // Loop through pos fields (pos1, pos2, ..., pos10)
    // Loop through pos fields (Pos1, Pos2, ..., Pos9)
   
    // Loop through Pos1 to Pos9 and populate them
    for (let i = 1; i <= 9; i++) {
        const posValue = data[`Pos${i}`];  // Access Pos1, Pos2, ..., Pos9
        const posSelect = document.getElementById(`pos${i}`);
        if (posSelect) {
            posSelect.value = posValue || "";  // Set empty if no value exists
        }
    }
                // document.getElementById("Alu_coil_width").value = data.Alu_coil_width;
                // document.getElementById("Alu_roller_type").value = data.Alu_roller_type;
                // document.getElementById("Spacer").value = data.Spacer;
                // document.getElementById("Motor_speed").value = data.Motor_speed;
                // document.getElementById("Motor_stroke").value = data.Motor_stroke;
                // document.getElementById("Motor_force").value = data.Motor_force;

                alert("Recipe loaded successfully!");
            } else {
                alert("Recipe not found!");  // Removed recipeId from this line
            }
        })
        .catch((error) => {
            console.error("Error loading recipe:", error);
            alert("An error occurred while loading the recipe.");
        });
}
// function loadLastPLCValues() {
//     fetch('/get_last_plc_values')  // Replace with your actual endpoint
//         .then(response => response.json())
//         .then(data => {
//             console.log("Last PLC Values:", data);
//             document.getElementById("Motor_speed").value = data.Motor_speed || "";
//             document.getElementById("Motor_stroke").value = data.Motor_stroke || "";
//             document.getElementById("Motor_force").value = data.Motor_force || "";
//             document.getElementById("Alu_coil_width").value = data.coil_Width || "";
//             alert("Last PLC values loaded successfully!");
//         })
//         .catch(error => {
//             console.error("Error fetching PLC values:", error);
//             alert("Failed to load last PLC values.");
//         });
// }
// /* Update function in recipe page*/
function loadLastPLCValues() {
    fetch('/get_last_plc_values')  // Replace with your actual endpoint
        .then(response => response.json())
        .then(data => {
            console.log("Last PLC Values:", data);

            // Loop through response data and update input fields dynamically
            Object.keys(data).forEach(key => {
                const inputField = document.getElementById(key);
                if (inputField) {
                    inputField.value = data[key] || "";
                } else {
                    console.warn(`No input field found for: ${key}`);
                }
            });

            alert("Last PLC values loaded successfully!");
        })
        .catch(error => {
            console.error("Error fetching PLC values:", error);
            alert("Failed to load last PLC values.");
        });
}

function openUpdatePopup(recipeId) {
    // Show the update popup
    document.getElementById('update-recipe-section').style.display = 'block';

    // Fetch the recipe details using recipeId
    fetch(`/get_recipe?recipe_id=${recipeId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
    document.getElementById("update_recipe_id").value = data.recipe_id;
    document.getElementById("update_recipe_name").value = data.recipe_name;
    document.getElementById("update_filter_size").value = data.filter_size;
    document.getElementById("update_filter_code").value = data.filter_code;
    document.getElementById("update_art_no").value = data.art_no;

    // Roll Positions
    // for (let i = 1; i <= 9; i++) {
    //     if (data[`pos${i}`] !== undefined) {
    //         document.getElementById(`update_pos${i}`).value = data[`pos${i}`];
    //     }
    // }
    for (let i = 1; i <= 9; i++) {
                    const posSelect = document.getElementById(`update_pos${i}`);
                    posSelect.value = data[`Pos${i}`] || ""; // Populate Pos1 to Pos9
                }

    // Machine Settings
    document.getElementById("update_alu_coil_width").value = data.Alu_coil_width;
    document.getElementById("update_alu_roller_type").value = data.Alu_roller_type;
    document.getElementById("update_spacer").value = data.Spacer;
    document.getElementById("update_motor_speed").value = data.Motor_speed;
    document.getElementById("update_motor_stroke").value = data.Motor_stroke;
    document.getElementById("update_motor_force").value = data.Motor_force;
    document.getElementById("update_Corr1Feed_length").value = data.Corr1Feed_length;
    document.getElementById("update_Corr2feed_length").value = data.Corr2feed_length;
    document.getElementById("update_Pleat_Height").value = data.Pleat_Height;
    document.getElementById("update_Blade_opening").value = data.Blade_opening;
    document.getElementById("update_Left_Blade_MediaTHickness").value = data.Left_Blade_MediaTHickness;
    document.getElementById("update_Right_Blade_MediaThickness").value = data.Right_Blade_MediaThickness;
    document.getElementById("update_Soft_Touch").value = data.Soft_Touch;
    document.getElementById("update_Press_Touch").value = data.Press_Touch;
    document.getElementById("update_Puller_Start_pos").value = data.Puller_Start_pos;
    document.getElementById("update_Puller_End_pos").value = data.Puller_End_pos;
    document.getElementById("update_Puller2_Feed_Correction").value = data.Puller2_Feed_Correction;
    document.getElementById("update_Filter_Box_Height").value = data.Filter_Box_Height;
    document.getElementById("update_Filter_Box_Width").value = data.Filter_Box_Width;
    document.getElementById("update_Filter_Box_Length").value = data.Filter_Box_Length;
    document.getElementById("update_Set_Pleat_Count").value = data.Set_Pleat_Count;
    document.getElementById("update_Set_Pleat_Pitch").value = data.Set_Pleat_Pitch;
    document.getElementById("update_Set_Batch_Count").value = data.Set_Batch_Count;
    document.getElementById("update_Machine_Speed_Ref").value = data.Machine_Speed_Ref;
    document.getElementById("update_Decoiler_Set_point").value = data.Decoiler_Set_point;
    document.getElementById("update_Low_Dia_Set").value = data.Low_Dia_Set;
    document.getElementById("update_Cutter_Park_pos").value = data.Cutter_Park_pos;
    document.getElementById("update_Cutter_Fwd_Pos").value = data.Cutter_Fwd_Pos;

    // Air Inspection Settings
    document.getElementById("update_databaseAvailable").value = data.databaseAvailable;
    document.getElementById("update_Width").value = data.Width;
    document.getElementById("update_Height").value = data.Height;
    document.getElementById("update_Depth").value = data.Depth;
    document.getElementById("update_Art_Num").value = data.Art_Num;
    document.getElementById("update_Air_Flow_Set").value = data.Air_Flow_Set;
    document.getElementById("update_Pressure_Drop_Setpoint").value = data.Pressure_Drop_Setpoint;
    document.getElementById("update_Lower_Tolerance1").value = data.Lower_Tolerance1;
    document.getElementById("update_Lower_Tolerance2").value = data.Lower_Tolerance2;
    document.getElementById("update_Upper_Tolerance1").value = data.Upper_Tolerance1;
    document.getElementById("update_Upper_Tolerance2").value = data.Upper_Tolerance2;
}
 else {
                alert("Recipe not found!");
            }
        })
        .catch(error => {
            console.error("Error fetching recipe:", error);
            alert("Failed to fetch recipe details.");
        });
}

function toggleUpdatePopup() {
    document.getElementById('update-recipe-section').style.display = 'none';
}

//code for the dropdown
document.addEventListener("DOMContentLoaded", function () {
    fetchRecipes();
});

function fetchRecipes() {
    fetch("/get_all_recipes")
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                populateDropdown("load_recipe_id", "dropdown_recipe_id", data.recipes, "recipe_id");
                populateDropdown("load_recipe_name", "dropdown_recipe_name", data.recipes, "recipe_name");
            } else {
                console.error("Error fetching recipes:", data.message);
            }
        })
        .catch((error) => {
            console.error("Error fetching recipe list:", error);
        });
}

function populateDropdown(inputId, dropdownId, recipes, key) {
    const inputField = document.getElementById(inputId);
    const dropdown = document.getElementById(dropdownId);
    const container = inputField.parentNode;

    recipes.forEach((recipe) => {
        const item = document.createElement("div");
        item.textContent = recipe[key];
        item.classList.add("dropdown-item");

        item.addEventListener("click", function () {
            inputField.value = recipe[key];
            dropdown.style.display = "none";
        });

        dropdown.appendChild(item);
    });

    // Show dropdown when clicking input or icon
    container.addEventListener("click", function () {
        dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    });

    // Hide dropdown when clicking outside
    document.addEventListener("click", function (event) {
        if (!container.contains(event.target)) {
            dropdown.style.display = "none";
        }
    });
}


</script>
{% endblock %}

